'use strict';

angular.module('directives.zigouigoui', [])
    .directive('zigouigoui', function() {


        var getAnimation = function(fillPaths, strokePaths){
            TweenMax.set(fillPaths, {
                opacity: 0
            });

            var tl = new TimelineMax({paused: true});

            angular.forEach(strokePaths, function(path) {
                var length = path.getTotalLength(),
                    strokeWidth = path.getAttribute("stroke-width");

                path.style.strokeDasharray = (length)+" "+(length);
                path.style.strokeDashoffset = (/Firefox/i.test(navigator.userAgent))? length/strokeWidth : length;

                tl.to(path.style, 1.7, {
                    strokeDashoffset: 0,
                    delay: -.5,
                    onUpdate: function(){
                        var n = document.createTextNode(' ');
                        document.body.appendChild(n);
                        document.body.removeChild(n);
                    }
                });
            });

            tl.to(fillPaths, 1.2, {
                opacity: 1,
                delay: -.5
            });

            return tl;
        };

        return {

            restrict: 'E',

            scope: {
                color: '@',
                noAnimation: '='
            },

            template: [

                '<svg style="max-width:100px; max-height:100px" enable-background="new 0 0 92.7 35" id="Calque_1" version="1.1" viewBox="0 0 92.7 35" x="0px" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" y="0px">',

                '    <path',
                '       class="stroke"',
                '       d="M69.1,7.6c-7-2.1-16.6,0.2-23.6,2.5 c-6.1,2.1-13.4,6.1-19.3,9.7c-5.4,3.2-16.7,6.4-20.4-1c0,0,0-0.1-0.1-0.1c-0.1-0.2-0.2-0.4-0.2-0.6c0-0.1,0-0.1,0-0.1',
                '       c-0.3-1.2-0.1-2.9,0.5-3.9c0.6-1.1,1.7-2.3,2.9-2.7c0.6-0.2,1.6-0.6,3.5-0.4c0,0,2.5,0.1,2.9,2.7l0,0.5c-0.5-0.5-1.1-0.8-1.9-0.9 c-1.6-0.1-2.9,1.1-3,2.7c0,0.4,0.1,0.8,0.2,1.2c0.2,0.6,0.7,1.1,1.3,1.5c0,0,0.1,0,0.1,0.1c0.8,0.3,1.7,0.5,2.7,0.3',
                '       c2-0.3,3.3-1.3,3.6-3.1c0-0.2,0.1-0.4,0.1-0.6c0-0.1,0.2-2.1-1-3.4c-0.2-0.2-2-2.4-6.7-1.8c-4.3,0.6-5.6,3.9-6,5.4 c-0.2,0.6-0.8,3.3,1.2,6.2c2.1,2.9,5,3.7,6.4,4c4.4,0.9,9.2,0.5,13.3-1.4c4.5-2.1,8.5-5.6,12.5-8c2.6-1.5,8.1-5.1,12.1-6.4',
                '       C56.2,8.2,61.4,6,67.5,7.2" fill="none" stroke-miterlimit="10" stroke-width="1" stroke="{{color}}"/>',

                '    <path',
                '       class="stroke"',
                '        d="M23.4,28.4c7,2.1,16.6-0.2,23.6-2.5 c6.1-2.1,13.4-6.1,19.3-9.7c5.4-3.2,16.7-6.4,20.4,1c0,0,0,0.1,0.1,0.1c0.1,0.2,0.2,0.4,0.2,0.6c0,0.1,0,0.1,0,0.1',
                '        c0.3,1.2,0.1,2.9-0.5,3.9c-0.6,1.1-1.7,2.3-2.9,2.7c-0.6,0.2-1.6,0.6-3.5,0.4c0,0-2.5-0.1-2.9-2.7l0-0.5c0.5,0.5,1.1,0.8,1.9,0.9 c1.6,0.1,2.9-1.1,3-2.7c0-0.4-0.1-0.8-0.2-1.2c-0.2-0.6-0.7-1.1-1.3-1.5c0,0-0.1,0-0.1-0.1c-0.8-0.3-1.7-0.5-2.7-0.3',
                '        c-2,0.3-3.3,1.3-3.6,3.1c0,0.2-0.1,0.4-0.1,0.6c0,0.1-0.2,2.1,1,3.4c0.2,0.2,2,2.4,6.7,1.8c4.3-0.6,5.6-3.9,6-5.4 c0.2-0.6,0.8-3.3-1.2-6.2c-2.1-2.9-5-3.7-6.4-4c-4.4-0.9-9.2-0.5-13.3,1.4c-4.5,2.1-8.5,5.6-12.5,8c-2.6,1.5-8.1,5.1-12.1,6.4',
                '        c-6.1,1.9-11.3,4.1-17.4,2.9" fill="none" stroke-miterlimit="10" stroke-width="1" stroke="{{color}}"/>',

                '    <path',
                '       class="fill"',
                '        d="M69.1,7.6c-7-2.1-16.6,0.2-23.6,2.5c-6.1,2.1-13.4,6.1-19.3,9.7c-5.4,3.2-16.7,6.4-20.4-1c0,0,0-0.1-0.1-0.1 c-0.1-0.2-0.2-0.4-0.2-0.6c0-0.1,0-0.1,0-0.1c-0.3-1.2-0.1-2.9,0.5-3.9c0.6-1.1,1.7-2.3,2.9-2.7c0.6-0.2,1.6-0.6,3.5-0.4',
                '        c0,0,2.5,0.1,2.9,2.7l0,0.5c-0.5-0.5-1.1-0.8-1.9-0.9c-1.6-0.1-2.9,1.1-3,2.7c0,0.4,0.1,0.8,0.2,1.2c0.2,0.6,0.7,1.1,1.3,1.5 c0,0,0.1,0,0.1,0.1c0.8,0.3,1.7,0.5,2.7,0.3c2-0.3,3.3-1.3,3.6-3.1c0-0.2,0.1-0.4,0.1-0.6c0-0.1,0.2-2.1-1-3.4',
                '        c-0.2-0.2-2-2.4-6.7-1.8c-4.3,0.6-5.6,3.9-6,5.4c-0.2,0.6-0.8,3.3,1.2,6.2c2.1,2.9,5,3.7,6.4,4c4.4,0.9,9.2,0.5,13.3-1.4 c4.5-2.1,8.5-5.6,12.5-8c2.6-1.5,8.1-5.1,12.1-6.4C56.2,8.2,61.4,6,67.5,7.2" fill="{{color}}" stroke-width="0"/>',

                '    <path',
                '       class="fill"',
                '        d="M23.4,28.4c7,2.1,16.6-0.2,23.6-2.5c6.1-2.1,13.4-6.1,19.3-9.7c5.4-3.2,16.7-6.4,20.4,1c0,0,0,0.1,0.1,0.1 c0.1,0.2,0.2,0.4,0.2,0.6c0,0.1,0,0.1,0,0.1c0.3,1.2,0.1,2.9-0.5,3.9c-0.6,1.1-1.7,2.3-2.9,2.7c-0.6,0.2-1.6,0.6-3.5,0.4',
                '        c0,0-2.5-0.1-2.9-2.7l0-0.5c0.5,0.5,1.1,0.8,1.9,0.9c1.6,0.1,2.9-1.1,3-2.7c0-0.4-0.1-0.8-0.2-1.2c-0.2-0.6-0.7-1.1-1.3-1.5 c0,0-0.1,0-0.1-0.1c-0.8-0.3-1.7-0.5-2.7-0.3c-2,0.3-3.3,1.3-3.6,3.1c0,0.2-0.1,0.4-0.1,0.6c0,0.1-0.2,2.1,1,3.4',
                '        c0.2,0.2,2,2.4,6.7,1.8c4.3-0.6,5.6-3.9,6-5.4c0.2-0.6,0.8-3.3-1.2-6.2c-2.1-2.9-5-3.7-6.4-4c-4.4-0.9-9.2-0.5-13.3,1.4 c-4.5,2.1-8.5,5.6-12.5,8c-2.6,1.5-8.1,5.1-12.1,6.4c-6.1,1.9-11.3,4.1-17.4,2.9" fill="{{color}}" stroke-width="0"/>',
                '</svg>'

            ].join(''),

            link: function(scope, element, attrs) {

                var fillPaths = element[0].querySelectorAll('.fill'),
                    strokePaths = element[0].querySelectorAll('.stroke');

                if (!scope.color) {
                    scope.color = '#525151';
                }

                if (!scope.noAnimation){
                    var tl = getAnimation(fillPaths, strokePaths);

                    setTimeout(function(){
                        tl.restart();
                    }, 1500);
                }
            }
        };
    });
